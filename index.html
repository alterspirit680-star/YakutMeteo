<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è –Ø–∫—É—Ç–∏–∏ - –ê–õ–†–û–°–ê</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>
    <style>
        :root {
            --primary: #1a5276;
            --secondary: #2874a6;
            --danger: #e74c3c;
            --warning: #f39c12;
            --success: #27ae60;
            --light: #ecf0f1;
            --dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }

        header {
            background-color: #226693;
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-img {
            height: 100px;
            width: auto;
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }

        .header-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .current-time {
            font-size: 1.1rem;
            font-weight: 500;
        }

        .timezone-info {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .btn-refresh {
            background-color: var(--warning);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-settings {
            background-color: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-map {
            background-color: var(--success);
            color: white;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        main {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }

        .last-update {
            color: var(--dark);
            font-size: 0.9rem;
        }

        .control-buttons {
            display: flex;
            gap: 10px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .weather-card {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .weather-card:hover {
            transform: translateY(-5px);
        }

        .weather-card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.4rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .weather-main {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .temperature {
            font-size: 3rem;
            font-weight: 700;
        }

        .weather-icon {
            font-size: 4rem;
            color: var(--secondary);
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .forecast-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .forecast-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .forecast-items {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        .forecast-item {
            text-align: center;
            padding: 8px;
            background: rgba(41, 116, 166, 0.05);
            border-radius: 6px;
        }

        .forecast-time {
            font-size: 0.8rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .forecast-temp {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 3px;
        }

        .forecast-wind {
            font-size: 0.8rem;
            color: var(--dark);
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            font-weight: 500;
        }

        .alert-danger {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border-left: 4px solid var(--danger);
        }

        .alert-warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border-left: 4px solid var(--warning);
        }

        .alert-success {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border-left: 4px solid var(--success);
        }

        .alert-helicopter {
            background-color: rgba(1, 113, 179, 0.1);
            color: #226693;
            border-left: 4px solid #226693;
        }

        .recommendation {
            background-color: rgba(41, 116, 166, 0.05);
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid var(--secondary);
        }

        .delete-location {
            background: none;
            border: none;
            color: var(--danger);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 5px;
        }

        .charts-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
            margin-bottom: 30px;
        }

        .charts-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }

        .advanced-section {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 20px;
        }

        .advanced-section h2 {
            color: var(--primary);
            margin-bottom: 20px;
        }

        .radar-chart {
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        footer {
            background-color: var(--dark);
            color: white;
            padding: 1.5rem 2rem;
            text-align: center;
            margin-top: 40px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: var(--secondary);
        }

        .api-status {
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 6px;
            font-weight: 500;
        }

        .api-status.success {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .api-status.warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .api-status.error {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .refresh-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 500px;
        }

        .map-modal {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .modal-header h2 {
            color: var(--primary);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-group h3 {
            margin-bottom: 10px;
            color: var(--secondary);
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .settings-label {
            font-weight: 500;
        }

        .settings-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        select, input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .settings-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .btn-cancel {
            background-color: #95a5a6;
            color: white;
        }

        .btn-save {
            background-color: var(--success);
            color: white;
        }

        .next-update {
            font-size: 0.85rem;
            color: var(--dark);
            margin-top: 5px;
        }

        .map-container {
            height: 400px;
            margin: 15px 0;
            border-radius: 8px;
            overflow: hidden;
        }

        .coordinates {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            margin: 10px 0;
        }

        .data-source-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
            text-align: right;
        }

        .source-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .source-yandex { background-color: #FF0000; }
        .source-openweather { background-color: #3498db; }
        .source-meteosource { background-color: #9b59b6; }
        .source-backup { background-color: #f39c12; }

        .ymaps-2-1-79-map {
            border-radius: 8px;
        }

        .ymaps-2-1-79-inner-panes {
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 15px;
            }

            .header-info {
                align-items: center;
            }

            .controls {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .control-buttons {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }

            .modal-content {
                padding: 20px;
                width: 95%;
            }

            .settings-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .map-modal {
                max-width: 95%;
            }

            .forecast-items {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="Logo.png" alt="–ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è –Ø–∫—É—Ç–∏–∏" class="logo-img">
            </div>
            <div class="header-info">
                <div class="current-time" id="currentTime">–ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–º–µ–Ω–∏...</div>
                <div class="timezone-info">–Ø–∫—É—Ç—Å–∫–æ–µ –≤—Ä–µ–º—è (UTC+9)</div>
            </div>
        </div>
    </header>

    <main>
        <div class="controls">
            <div>
                <div class="last-update" id="lastUpdate">
                    –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∑–∫–∞...
                </div>
                <div class="next-update" id="nextUpdate">
                    –°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∑–∞–≥—Ä—É–∑–∫–∞...
                </div>
            </div>
            <div class="control-buttons">
                <button class="btn btn-map" id="mapBtn">
                    <span>üó∫Ô∏è</span>
                    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É
                </button>
                <button class="btn btn-settings" id="settingsBtn">
                    <span>‚öôÔ∏è</span>
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </button>
                <button class="btn btn-refresh" id="refreshBtn">
                    <span id="refreshIcon">üîÑ</span>
                    –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                </button>
            </div>
        </div>

        <div id="apiStatus"></div>
        <div class="loading" id="loadingIndicator">
            –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≥–æ–¥–µ...
        </div>

        <section class="dashboard" id="weatherDashboard" style="display: none;">
        </section>

        <section class="charts-section" id="chartsSection" style="display: none;">
            <h2>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç–µ–æ—É—Å–ª–æ–≤–∏–π</h2>
            <div class="chart-container">
                <canvas id="temperatureChart"></canvas>
            </div>
        </section>

        <section class="advanced-section" id="advancedSection" style="display: none;">
            <h2>–†–∞–¥–∞—Ä-–¥–∏–∞–≥—Ä–∞–º–º–∞ –º–µ—Ç–µ–æ—É—Å–ª–æ–≤–∏–π</h2>
            <div class="radar-chart">
                <canvas id="radarChart"></canvas>
            </div>
        </section>
    </main>

    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h2>
                <button class="close-modal" id="closeSettingsModal">&times;</button>
            </div>

            <div class="settings-group">
                <h3>–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="settings-row">
                    <div class="settings-label">–ò–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:</div>
                    <div class="settings-control">
                        <select id="updateInterval">
                            <option value="1">1 –º–∏–Ω—É—Ç–∞</option>
                            <option value="5">5 –º–∏–Ω—É—Ç</option>
                            <option value="10" selected>10 –º–∏–Ω—É—Ç</option>
                            <option value="15">15 –º–∏–Ω—É—Ç</option>
                            <option value="30">30 –º–∏–Ω—É—Ç</option>
                            <option value="60">1 —á–∞—Å</option>
                            <option value="0">–û—Ç–∫–ª—é—á–µ–Ω–æ</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3>–ü–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ–ø–æ–≤–µ—â–µ–Ω–∏–π</h3>
                <div class="settings-row">
                    <div class="settings-label">–ú–∞–∫—Å. —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ (–º/—Å):</div>
                    <div class="settings-control">
                        <input type="number" id="maxWindSpeed" value="15" min="5" max="30">
                    </div>
                </div>
                <div class="settings-row">
                    <div class="settings-label">–ú–∏–Ω. —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C):</div>
                    <div class="settings-control">
                        <input type="number" id="minTemperature" value="-45" min="-60" max="-20">
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <h3>–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö</h3>
                <div class="settings-row">
                    <div class="settings-label">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:</div>
                    <div class="settings-control">
                        <select id="dataSourcePriority">
                            <option value="yandex,openweather,meteosource">–Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞ ‚Üí OpenWeather ‚Üí MeteoSource</option>
                            <option value="yandex,meteosource,openweather">–Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞ ‚Üí MeteoSource ‚Üí OpenWeather</option>
                            <option value="openweather,yandex,meteosource">OpenWeather ‚Üí –Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞ ‚Üí MeteoSource</option>
                            <option value="openweather,meteosource,yandex">OpenWeather ‚Üí MeteoSource ‚Üí –Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞</option>
                            <option value="meteosource,yandex,openweather">MeteoSource ‚Üí –Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞ ‚Üí OpenWeather</option>
                            <option value="meteosource,openweather,yandex">MeteoSource ‚Üí OpenWeather ‚Üí –Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="settings-actions">
                <button class="btn btn-cancel" id="cancelSettings">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-save" id="saveSettings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="mapModal">
        <div class="modal-content map-modal">
            <div class="modal-header">
                <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Ç–æ—á–∫—É</h2>
                <button class="close-modal" id="closeMapModal">&times;</button>
            </div>

            <div class="settings-group">
                <div class="settings-row">
                    <label class="settings-label">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏:</label>
                    <input type="text" id="locationName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" style="width: 200px;">
                </div>
            </div>

            <div class="map-container" id="map"></div>

            <div class="coordinates" id="coordinates">
                –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 62.0340, 129.7320
            </div>

            <div class="settings-actions">
                <button class="btn btn-cancel" id="cancelMap">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-save" id="saveLocation">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>–ú–µ—Ç–µ–æ—Å—Ç–∞–Ω—Ü–∏—è –Ø–∫—É—Ç–∏–∏ &copy; 2025 | –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –¥–ª—è –ê–õ–†–û–°–ê</p>
            <p style="margin-top: 10px; font-size: 0.9rem;">–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ–ª–µ—Ç–æ–≤ –∏ —Ä–∞–±–æ—Ç –Ω–∞ –∫–∞—Ä—å–µ—Ä–∞—Ö</p>
        </div>
    </footer>

    <script>
        const DEFAULT_CONFIG = {
            UPDATE_INTERVAL: 10,
            ALERT_THRESHOLDS: {
                WIND_SPEED: 15,
                TEMPERATURE: -45
            },
            DATA_SOURCE_PRIORITY: "yandex,openweather,meteosource",
            LOCATIONS: [
                { name: '–ú–∏—Ä–Ω—ã–π', lat: 62.5343, lon: 113.9610 },
                { name: '–£–¥–∞—á–Ω—ã–π', lat: 66.4166, lon: 112.4000 },
                { name: '–ê–π—Ö–∞–ª', lat: 65.9333, lon: 111.4833 }
            ]
        };

        const API_KEYS = {
            YANDEX_WEATHER: '2eedcd80-4ca8-40bb-b229-b0a6e59a760e',
            OPENWEATHER: '7253447bdd5d5b3a73b932e71fcaa87b',
            METEOSOURCE: 'demo'
        };

        const BACKUP_DATA = {
            '–ú–∏—Ä–Ω—ã–π': {
                temp: -42,
                feels_like: -58,
                humidity: 75,
                pressure: 765,
                wind_speed: 15,
                weather_icon: '13d',
                weather_description: '—Å–Ω–µ–≥',
                forecast: generateForecast(-42, 15)
            },
            '–£–¥–∞—á–Ω—ã–π': {
                temp: -38,
                feels_like: -52,
                humidity: 80,
                pressure: 768,
                wind_speed: 12,
                weather_icon: '04d',
                weather_description: '–æ–±–ª–∞—á–Ω–æ',
                forecast: generateForecast(-38, 12)
            },
            '–ê–π—Ö–∞–ª': {
                temp: -35,
                feels_like: -45,
                humidity: 70,
                pressure: 770,
                wind_speed: 8,
                weather_icon: '01d',
                weather_description: '—è—Å–Ω–æ',
                forecast: generateForecast(-35, 8)
            }
        };

        function generateForecast(baseTemp, baseWind) {
            return [
                {
                    time: '–ß–µ—Ä–µ–∑ 1 —á–∞—Å',
                    temp: Math.round(baseTemp + (Math.random() - 0.5) * 2),
                    wind: Math.round(baseWind + (Math.random() - 0.5) * 3)
                },
                {
                    time: '–ß–µ—Ä–µ–∑ 6 —á–∞—Å–æ–≤',
                    temp: Math.round(baseTemp + (Math.random() - 0.5) * 4),
                    wind: Math.round(baseWind + (Math.random() - 0.5) * 5)
                },
                {
                    time: '–ß–µ—Ä–µ–∑ 8 —á–∞—Å–æ–≤',
                    temp: Math.round(baseTemp + (Math.random() - 0.5) * 5),
                    wind: Math.round(baseWind + (Math.random() - 0.5) * 6)
                }
            ];
        }

        let weatherData = {};
        let temperatureChart = null;
        let radarChart = null;
        let apiWorking = false;
        let lastUpdateTime = null;
        let nextUpdateTime = null;
        let updateIntervalId = null;
        let appConfig = JSON.parse(JSON.stringify(DEFAULT_CONFIG));
        let customLocations = [];
        let yandexMap = null;
        let yandexPlacemark = null;
        let currentDataSource = '';

        function loadConfig() {
            const savedConfig = localStorage.getItem('weatherAppConfig');
            const savedLocations = localStorage.getItem('customLocations');

            appConfig = JSON.parse(JSON.stringify(DEFAULT_CONFIG));

            if (savedConfig) {
                try {
                    const parsedConfig = JSON.parse(savedConfig);
                    appConfig.UPDATE_INTERVAL = parsedConfig.UPDATE_INTERVAL || DEFAULT_CONFIG.UPDATE_INTERVAL;
                    appConfig.ALERT_THRESHOLDS = {
                        ...DEFAULT_CONFIG.ALERT_THRESHOLDS,
                        ...parsedConfig.ALERT_THRESHOLDS
                    };
                    appConfig.DATA_SOURCE_PRIORITY = parsedConfig.DATA_SOURCE_PRIORITY || DEFAULT_CONFIG.DATA_SOURCE_PRIORITY;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:', e);
                }
            }

            if (savedLocations) {
                try {
                    customLocations = JSON.parse(savedLocations);
                    customLocations = customLocations.filter(loc =>
                        loc && loc.name && typeof loc.lat === 'number' && typeof loc.lon === 'number'
                    );
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ª–æ–∫–∞—Ü–∏–π:', e);
                    customLocations = [];
                }
            }

            return appConfig;
        }

        function saveConfig() {
            localStorage.setItem('weatherAppConfig', JSON.stringify(appConfig));
            localStorage.setItem('customLocations', JSON.stringify(customLocations));
        }

        function applyConfigToUI() {
            document.getElementById('updateInterval').value = appConfig.UPDATE_INTERVAL;
            document.getElementById('maxWindSpeed').value = appConfig.ALERT_THRESHOLDS.WIND_SPEED;
            document.getElementById('minTemperature').value = appConfig.ALERT_THRESHOLDS.TEMPERATURE;
            document.getElementById('dataSourcePriority').value = appConfig.DATA_SOURCE_PRIORITY;
            setupAutoUpdate();
        }

        function getYakutskTime() {
            const now = new Date();
            const yakutskOffset = 9 * 60;
            const localOffset = now.getTimezoneOffset();
            return new Date(now.getTime() + (localOffset + yakutskOffset) * 60000);
        }

        function formatTime(date) {
            return date.toLocaleTimeString('ru-RU', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function formatDateTime(date) {
            return date.toLocaleString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        function formatTimeUntil(targetDate) {
            const now = new Date();
            const diffMs = targetDate - now;
            if (diffMs <= 0) return '—Å–µ–π—á–∞—Å';

            const diffSecs = Math.floor(diffMs / 1000);
            const diffMins = Math.floor(diffSecs / 60);
            const diffHours = Math.floor(diffMins / 60);
            const remainingMins = diffMins % 60;
            const remainingSecs = diffSecs % 60;

            if (diffHours > 0) {
                return `—á–µ—Ä–µ–∑ ${diffHours}—á ${remainingMins}–º ${remainingSecs}—Å`;
            } else if (diffMins > 0) {
                return `—á–µ—Ä–µ–∑ ${diffMins}–º ${remainingSecs}—Å`;
            } else {
                return `—á–µ—Ä–µ–∑ ${diffSecs}—Å`;
            }
        }

        function updateHeaderTime() {
            const yakutskTime = getYakutskTime();
            document.getElementById('currentTime').textContent = formatTime(yakutskTime);
        }

        function updateLastUpdateTime() {
            if (lastUpdateTime) {
                document.getElementById('lastUpdate').textContent =
                    `–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${formatDateTime(lastUpdateTime)}`;
            }
        }

        function updateNextUpdateInfo() {
            if (appConfig.UPDATE_INTERVAL > 0 && lastUpdateTime) {
                nextUpdateTime = new Date(lastUpdateTime.getTime() + appConfig.UPDATE_INTERVAL * 60000);
                document.getElementById('nextUpdate').textContent =
                    `–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${formatTimeUntil(nextUpdateTime)}`;
            } else {
                document.getElementById('nextUpdate').textContent =
                    '–°–ª–µ–¥—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ';
            }
        }

        async function fetchWeatherData() {
            const allLocations = [...appConfig.LOCATIONS, ...customLocations];
            const dataSources = appConfig.DATA_SOURCE_PRIORITY.split(',');

            const weatherPromises = allLocations.map(location =>
                fetchWeatherFromMultipleSources(location.lat, location.lon, location.name, dataSources)
            );

            const results = await Promise.all(weatherPromises);

            weatherData = {};
            results.forEach((result, index) => {
                const locationName = allLocations[index].name;
                weatherData[locationName] = result;
            });

            apiWorking = results.some(result => !result.fromBackup);
            currentDataSource = results[0]?.dataSource || 'backup';

            return weatherData;
        }

        async function fetchWeatherFromMultipleSources(lat, lon, locationName, dataSources) {
            for (const source of dataSources) {
                try {
                    let data;
                    switch (source) {
                        case 'yandex':
                            data = await fetchFromYandexWeather(lat, lon);
                            break;
                        case 'openweather':
                            data = await fetchFromOpenWeather(lat, lon);
                            break;
                        case 'meteosource':
                            data = await fetchFromMeteoSource(lat, lon);
                            break;
                    }

                    if (data) {
                        return {
                            ...data,
                            location: locationName,
                            dataSource: source,
                            fromBackup: false
                        };
                    }
                } catch (error) {
                    continue;
                }
            }

            return {
                ...getBackupData(locationName),
                dataSource: 'backup',
                fromBackup: true
            };
        }

        async function fetchFromYandexWeather(lat, lon) {
            try {
                const url = `https://api.weather.yandex.ru/v2/forecast?lat=${lat}&lon=${lon}&limit=1&hours=false&extra=false`;

                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'X-Yandex-API-Key': API_KEYS.YANDEX_WEATHER
                    }
                });

                if (!response.ok) {
                    throw new Error(`Yandex Weather API error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();

                const fact = data.fact;

                return {
                    temp: fact.temp,
                    feels_like: fact.feels_like,
                    humidity: fact.humidity,
                    pressure: fact.pressure_mm,
                    wind_speed: fact.wind_speed,
                    weather_icon: getYandexWeatherIcon(fact.icon),
                    weather_description: getYandexWeatherDescription(fact.condition),
                    timestamp: new Date().toISOString(),
                    forecast: generateForecast(fact.temp, fact.wind_speed)
                };
            } catch (error) {
                throw error;
            }
        }

        function getYandexWeatherIcon(iconCode) {
            const iconMap = {
                'skc_d': '01d', 'skc_n': '01n',
                'ovc': '04d', 'ovc_-ra': '10d', 'ovc_ra': '09d',
                'bkn_d': '03d', 'bkn_n': '03n',
                'bkn_-ra_d': '10d', 'bkn_-ra_n': '10n',
                'bkn_ra_d': '09d', 'bkn_ra_n': '09n',
                'bkn_sn_d': '13d', 'bkn_sn_n': '13n',
                'ovc_sn': '13d', 'ovc_+sn': '13d'
            };
            return iconMap[iconCode] || '02d';
        }

        function getYandexWeatherDescription(condition) {
            const descriptionMap = {
                'clear': '—è—Å–Ω–æ',
                'partly-cloudy': '–º–∞–ª–æ–æ–±–ª–∞—á–Ω–æ',
                'cloudy': '–æ–±–ª–∞—á–Ω–æ —Å –ø—Ä–æ—è—Å–Ω–µ–Ω–∏—è–º–∏',
                'overcast': '–ø–∞—Å–º—É—Ä–Ω–æ',
                'light-rain': '–Ω–µ–±–æ–ª—å—à–æ–π –¥–æ–∂–¥—å',
                'rain': '–¥–æ–∂–¥—å',
                'heavy-rain': '—Å–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å',
                'showers': '–ª–∏–≤–µ–Ω—å',
                'wet-snow': '–¥–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º',
                'light-snow': '–Ω–µ–±–æ–ª—å—à–æ–π —Å–Ω–µ–≥',
                'snow': '—Å–Ω–µ–≥',
                'snow-showers': '—Å–Ω–µ–≥–æ–ø–∞–¥',
                'hail': '–≥—Ä–∞–¥',
                'thunderstorm': '–≥—Ä–æ–∑–∞',
                'thunderstorm-with-rain': '–¥–æ–∂–¥—å —Å –≥—Ä–æ–∑–æ–π',
                'thunderstorm-with-hail': '–≥—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º'
            };
            return descriptionMap[condition] || condition;
        }

        async function fetchFromOpenWeather(lat, lon) {
            try {
                const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEYS.OPENWEATHER}&units=metric&lang=ru`;

                const response = await fetch(url);
                if (!response.ok) throw new Error(`OpenWeather: ${response.status}`);

                const data = await response.json();

                return {
                    temp: Math.round(data.main.temp),
                    feels_like: Math.round(data.main.feels_like),
                    humidity: data.main.humidity,
                    pressure: Math.round(data.main.pressure * 0.750062),
                    wind_speed: data.wind.speed || 0,
                    weather_icon: data.weather[0].icon,
                    weather_description: data.weather[0].description,
                    timestamp: new Date().toISOString(),
                    forecast: generateForecast(Math.round(data.main.temp), data.wind.speed || 0)
                };
            } catch (error) {
                throw new Error('OpenWeather unavailable');
            }
        }

        async function fetchFromMeteoSource(lat, lon) {
            try {
                const url = `https://www.meteosource.com/api/v1/free/point?lat=${lat}&lon=${lon}&sections=current&key=${API_KEYS.METEOSOURCE}`;

                const response = await fetch(url);
                if (!response.ok) throw new Error(`MeteoSource: ${response.status}`);

                const data = await response.json();

                return {
                    temp: Math.round(data.current.temperature),
                    feels_like: Math.round(data.current.feels_like),
                    humidity: data.current.humidity,
                    pressure: Math.round(data.current.pressure),
                    wind_speed: data.current.wind.speed || 0,
                    weather_icon: getMeteoSourceWeatherIcon(data.current.icon),
                    weather_description: data.current.summary,
                    timestamp: new Date().toISOString(),
                    forecast: generateForecast(Math.round(data.current.temperature), data.current.wind.speed || 0)
                };
            } catch (error) {
                throw new Error('MeteoSource unavailable');
            }
        }

        function getMeteoSourceWeatherIcon(iconCode) {
            const iconMap = {
                'clear': '01d',
                'partly_cloudy': '02d',
                'cloudy': '03d',
                'overcast': '04d',
                'fog': '50d',
                'rain': '10d',
                'snow': '13d',
                'thunderstorm': '11d'
            };
            return iconMap[iconCode] || '02d';
        }

        function getBackupData(locationName) {
            const data = BACKUP_DATA[locationName] || BACKUP_DATA['–ú–∏—Ä–Ω—ã–π'];
            return {
                temp: data.temp,
                feels_like: data.feels_like,
                humidity: data.humidity,
                pressure: data.pressure,
                wind_speed: data.wind_speed,
                weather_icon: data.weather_icon,
                weather_description: data.weather_description,
                timestamp: new Date().toISOString(),
                forecast: data.forecast
            };
        }

        function getAlertType(value, threshold, isWind = false) {
            if (isWind) {
                if (value > threshold) return 'danger';
                if (value > threshold - 3) return 'warning';
                return 'success';
            } else {
                if (value < threshold) return 'danger';
                if (value < threshold + 5) return 'warning';
                return 'success';
            }
        }

        function getWeatherIcon(weatherCode) {
            const iconMap = {
                '01d': '‚òÄÔ∏è', '01n': 'üåô', '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
                '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è', '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è', '10d': 'üå¶Ô∏è', '10n': 'üå¶Ô∏è',
                '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è', '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
            };
            return iconMap[weatherCode] || 'üå§Ô∏è';
        }

        function getDataSourceColor(source) {
            const colorMap = {
                'yandex': 'source-yandex',
                'openweather': 'source-openweather',
                'meteosource': 'source-meteosource',
                'backup': 'source-backup'
            };
            return colorMap[source] || 'source-backup';
        }

        function getDataSourceName(source) {
            const nameMap = {
                'yandex': '–Ø–Ω–¥–µ–∫—Å –ü–æ–≥–æ–¥–∞',
                'openweather': 'OpenWeather',
                'meteosource': 'MeteoSource',
                'backup': '–†–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'
            };
            return nameMap[source] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫';
        }

        function renderWeatherCards() {
            const dashboard = document.getElementById('weatherDashboard');
            dashboard.innerHTML = '';

            const allLocations = [...appConfig.LOCATIONS, ...customLocations];

            allLocations.forEach(location => {
                const locationData = weatherData[location.name];

                if (!locationData) {
                    dashboard.innerHTML += `
                        <div class="weather-card">
                            <h2>${location.name} <span class="time">--:--:--</span></h2>
                            <div class="loading">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
                        </div>
                    `;
                    return;
                }

                const temp = locationData.temp;
                const feelsLike = locationData.feels_like;
                const windSpeed = locationData.wind_speed;
                const humidity = locationData.humidity;
                const pressure = locationData.pressure;
                const weatherIcon = getWeatherIcon(locationData.weather_icon);
                const forecast = locationData.forecast || [];
                const dataSource = locationData.dataSource || 'backup';

                const windAlertType = getAlertType(windSpeed, appConfig.ALERT_THRESHOLDS.WIND_SPEED, true);
                const tempAlertType = getAlertType(temp, appConfig.ALERT_THRESHOLDS.TEMPERATURE, false);

                const windAlertClass = windAlertType === 'success' ? 'alert-helicopter' : `alert-${windAlertType}`;
                const tempAlertClass = `alert-${tempAlertType}`;

                let windAlertText = '';
                let tempAlertText = '';

                if (windAlertType === 'danger') {
                    windAlertText = `‚ö†Ô∏è –í–ó–õ–ï–¢ –í–ï–†–¢–û–õ–ï–¢–ê–ú –ó–ê–ü–†–ï–©–ï–ù: –≤–µ—Ç–µ—Ä ${windSpeed} –º/—Å –ø—Ä–µ–≤—ã—à–∞–µ—Ç –Ω–æ—Ä–º—É ${appConfig.ALERT_THRESHOLDS.WIND_SPEED} –º/—Å`;
                } else if (windAlertType === 'warning') {
                    windAlertText = `‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –î–õ–Ø –í–ï–†–¢–û–õ–ï–¢–û–í: –≤–µ—Ç–µ—Ä ${windSpeed} –º/—Å –±–ª–∏–∑–æ–∫ –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–º—É`;
                } else {
                    windAlertText = '‚úÖ –£–°–õ–û–í–ò–Ø –î–õ–Ø –ü–û–õ–ï–¢–û–í –ù–û–†–ú–ê–õ–¨–ù–´–ï';
                }

                if (tempAlertType === 'danger') {
                    tempAlertText = `‚ö†Ô∏è –†–ê–ë–û–¢–´ –ü–†–ò–û–°–¢–ê–ù–û–í–õ–ï–ù–´: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${temp}¬∞C –Ω–∏–∂–µ –Ω–æ—Ä–º—ã ${appConfig.ALERT_THRESHOLDS.TEMPERATURE}¬∞C`;
                } else if (tempAlertType === 'warning') {
                    tempAlertText = `‚ö†Ô∏è –û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø –î–õ–Ø –†–ê–ë–û–¢: —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ ${temp}¬∞C –±–ª–∏–∑–∫–∞ –∫ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π`;
                } else {
                    tempAlertText = '‚úÖ –†–ê–ë–û–¢–´ –†–ê–ó–†–ï–®–ï–ù–´';
                }

                const isCustom = customLocations.some(loc => loc.name === location.name);
                const deleteButton = isCustom ?
                    `<button class="delete-location" onclick="deleteCustomLocation('${location.name}')">üóëÔ∏è</button>` : '';

                const forecastHTML = forecast.length > 0 ? `
                    <div class="forecast-section">
                        <div class="forecast-title">–ü—Ä–æ–≥–Ω–æ–∑ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏ –≤–µ—Ç—Ä–∞:</div>
                        <div class="forecast-items">
                            ${forecast.map(item => `
                                <div class="forecast-item">
                                    <div class="forecast-time">${item.time}</div>
                                    <div class="forecast-temp">${item.temp}¬∞C</div>
                                    <div class="forecast-wind">${item.wind} –º/—Å</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : '';

                dashboard.innerHTML += `
                    <div class="weather-card">
                        <h2>${location.name} ${deleteButton}<span class="time">${formatTime(getYakutskTime())}</span></h2>
                        <div class="data-source-info">
                            <span class="source-indicator ${getDataSourceColor(dataSource)}"></span>
                            –ò—Å—Ç–æ—á–Ω–∏–∫: ${getDataSourceName(dataSource)}
                        </div>
                        <div class="weather-main">
                            <div class="temperature">${temp}¬∞C</div>
                            <div class="weather-icon">${weatherIcon}</div>
                        </div>
                        <div class="weather-details">
                            <div class="detail-item">
                                <span>–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫:</span>
                                <span>${feelsLike}¬∞C</span>
                            </div>
                            <div class="detail-item">
                                <span>–í–µ—Ç–µ—Ä:</span>
                                <span>${windSpeed} –º/—Å</span>
                            </div>
                            <div class="detail-item">
                                <span>–í–ª–∞–∂–Ω–æ—Å—Ç—å:</span>
                                <span>${humidity}%</span>
                            </div>
                            <div class="detail-item">
                                <span>–î–∞–≤–ª–µ–Ω–∏–µ:</span>
                                <span>${pressure} –º–º —Ä—Ç.—Å—Ç.</span>
                            </div>
                        </div>
                        ${forecastHTML}
                        <div class="alert ${windAlertClass}">
                            ${windAlertText}
                        </div>
                        <div class="alert ${tempAlertClass}">
                            ${tempAlertText}
                        </div>
                    </div>
                `;
            });
        }

        function deleteCustomLocation(locationName) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ç–æ—á–∫—É "${locationName}"?`)) {
                customLocations = customLocations.filter(loc => loc.name !== locationName);
                saveConfig();
                refreshData();
            }
        }

        function createTemperatureChart() {
            const ctx = document.getElementById('temperatureChart').getContext('2d');
            const allLocations = [...appConfig.LOCATIONS, ...customLocations];

            const labels = allLocations.map(loc => loc.name);
            const temperatures = allLocations.map(loc =>
                weatherData[loc.name] ? weatherData[loc.name].temp : 0
            );
            const feelsLikeTemps = allLocations.map(loc =>
                weatherData[loc.name] ? weatherData[loc.name].feels_like : 0
            );

            if (temperatureChart) {
                temperatureChart.destroy();
            }

            temperatureChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)',
                            data: temperatures,
                            backgroundColor: 'rgba(41, 116, 166, 0.7)',
                            borderColor: 'rgba(41, 116, 166, 1)',
                            borderWidth: 1
                        },
                        {
                            label: '–û—â—É—â–∞–µ—Ç—Å—è –∫–∞–∫ (¬∞C)',
                            data: feelsLikeTemps,
                            backgroundColor: 'rgba(231, 76, 60, 0.7)',
                            borderColor: 'rgba(231, 76, 60, 1)',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)'
                            }
                        }
                    }
                }
            });
        }

        function createRadarChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            const allLocations = [...appConfig.LOCATIONS, ...customLocations];
            const labels = allLocations.map(loc => loc.name);

            const datasets = [
                {
                    label: '–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞',
                    data: allLocations.map(loc =>
                        weatherData[loc.name] ? Math.max(weatherData[loc.name].temp + 50, 0) : 0
                    ),
                    backgroundColor: 'rgba(231, 76, 60, 0.2)',
                    borderColor: 'rgba(231, 76, 60, 1)',
                    borderWidth: 1
                },
                {
                    label: '–í–µ—Ç–µ—Ä',
                    data: allLocations.map(loc =>
                        weatherData[loc.name] ? Math.min(weatherData[loc.name].wind_speed * 5, 100) : 0
                    ),
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    borderWidth: 1
                },
                {
                    label: '–í–ª–∞–∂–Ω–æ—Å—Ç—å',
                    data: allLocations.map(loc =>
                        weatherData[loc.name] ? weatherData[loc.name].humidity : 0
                    ),
                    backgroundColor: 'rgba(46, 204, 113, 0.2)',
                    borderColor: 'rgba(46, 204, 113, 1)',
                    borderWidth: 1
                }
            ];

            if (radarChart) {
                radarChart.destroy();
            }

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        function updateApiStatus() {
            const statusElement = document.getElementById('apiStatus');
            const allLocations = [...appConfig.LOCATIONS, ...customLocations];

            const failedLocations = allLocations.filter(location =>
                weatherData[location.name] && weatherData[location.name].fromBackup
            );

            if (apiWorking) {
                if (failedLocations.length > 0) {
                    statusElement.innerHTML = `
                        <div class="api-status warning">
                            ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫: ${getDataSourceName(currentDataSource)}.
                            –û—à–∏–±–∫–∏ –¥–ª—è: ${failedLocations.map(loc => loc.name).join(', ')}
                        </div>
                    `;
                } else {
                    statusElement.innerHTML = `
                        <div class="api-status success">
                            ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞: ${getDataSourceName(currentDataSource)}
                        </div>
                    `;
                }
            } else {
                statusElement.innerHTML = `
                    <div class="api-status error">
                        ‚ö†Ô∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É.
                    </div>
                `;
            }
        }

        function initYandexMap() {
            if (!ymaps) {
                return;
            }

            ymaps.ready(function() {
                yandexMap = new ymaps.Map('map', {
                    center: [62.0340, 129.7320],
                    zoom: 5,
                    controls: ['zoomControl', 'fullscreenControl']
                }, {
                    searchControlProvider: 'yandex#search'
                });

                yandexPlacemark = new ymaps.Placemark([62.0340, 129.7320], {
                    balloonContent: '–í—ã–±—Ä–∞–Ω–Ω–∞—è —Ç–æ—á–∫–∞'
                }, {
                    preset: 'islands#blueIcon',
                    draggable: true
                });

                yandexMap.geoObjects.add(yandexPlacemark);

                yandexPlacemark.events.add('dragend', function () {
                    const coords = yandexPlacemark.geometry.getCoordinates();
                    updateCoordinates(coords[0], coords[1]);
                });

                yandexMap.events.add('click', function (e) {
                    const coords = e.get('coords');
                    yandexPlacemark.geometry.setCoordinates(coords);
                    updateCoordinates(coords[0], coords[1]);
                });
            });
        }

        function updateCoordinates(lat, lon) {
            document.getElementById('coordinates').textContent =
                `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${lat.toFixed(4)}, ${lon.toFixed(4)}`;
        }

        function addCustomLocation() {
            const locationName = document.getElementById('locationName').value.trim();
            const coordsText = document.getElementById('coordinates').textContent;
            const coordsMatch = coordsText.match(/–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ([\d.-]+), ([\d.-]+)/);

            if (!locationName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏');
                return;
            }

            if (coordsMatch) {
                const lat = parseFloat(coordsMatch[1]);
                const lon = parseFloat(coordsMatch[2]);

                const newLocation = {
                    name: locationName,
                    lat: lat,
                    lon: lon
                };

                if (customLocations.length >= 4) {
                    alert('–ú–∞–∫—Å–∏–º—É–º 4 –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏');
                    return;
                }

                if (customLocations.some(loc => loc.name === locationName) ||
                    appConfig.LOCATIONS.some(loc => loc.name === locationName)) {
                    alert('–¢–æ—á–∫–∞ —Å —Ç–∞–∫–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    return;
                }

                customLocations.push(newLocation);
                saveConfig();

                document.getElementById('locationName').value = '';
                document.getElementById('mapModal').style.display = 'none';

                refreshData();
                alert(`–¢–æ—á–∫–∞ "${locationName}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!`);
            }
        }

        function setupAutoUpdate() {
            if (updateIntervalId) {
                clearInterval(updateIntervalId);
                updateIntervalId = null;
            }

            if (appConfig.UPDATE_INTERVAL > 0) {
                const intervalMs = appConfig.UPDATE_INTERVAL * 60 * 1000;
                updateIntervalId = setInterval(refreshData, intervalMs);
            }

            updateNextUpdateInfo();
        }

        async function refreshData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const refreshIcon = document.getElementById('refreshIcon');

            refreshBtn.disabled = true;
            refreshIcon.classList.add('refresh-spin');

            try {
                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('weatherDashboard').style.display = 'none';

                await fetchWeatherData();
                lastUpdateTime = getYakutskTime();

                updateApiStatus();
                updateLastUpdateTime();
                updateNextUpdateInfo();

                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('weatherDashboard').style.display = 'grid';
                document.getElementById('chartsSection').style.display = 'block';
                document.getElementById('advancedSection').style.display = 'block';

                renderWeatherCards();
                createTemperatureChart();
                createRadarChart();

            } catch (error) {
                console.error('Error refreshing data:', error);
            } finally {
                refreshBtn.disabled = false;
                refreshIcon.classList.remove('refresh-spin');
            }
        }

        function openSettingsModal() {
            document.getElementById('settingsModal').style.display = 'flex';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').style.display = 'none';
        }

        function openMapModal() {
            document.getElementById('mapModal').style.display = 'flex';
            if (!yandexMap) {
                setTimeout(initYandexMap, 100);
            }
        }

        function closeMapModal() {
            document.getElementById('mapModal').style.display = 'none';
        }

        function saveSettings() {
            appConfig.UPDATE_INTERVAL = parseInt(document.getElementById('updateInterval').value);
            appConfig.ALERT_THRESHOLDS.WIND_SPEED = parseInt(document.getElementById('maxWindSpeed').value);
            appConfig.ALERT_THRESHOLDS.TEMPERATURE = parseInt(document.getElementById('minTemperature').value);
            appConfig.DATA_SOURCE_PRIORITY = document.getElementById('dataSourcePriority').value;

            saveConfig();
            setupAutoUpdate();
            updateNextUpdateInfo();
            renderWeatherCards();

            closeSettingsModal();
            alert('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        function resetConfig() {
            localStorage.removeItem('weatherAppConfig');
            localStorage.removeItem('customLocations');
            appConfig = JSON.parse(JSON.stringify(DEFAULT_CONFIG));
            customLocations = [];
            saveConfig();
            location.reload();
        }

        function addDebugButton() {
            const debugBtn = document.createElement('button');
            debugBtn.textContent = '–°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏';
            debugBtn.className = 'btn btn-outline';
            debugBtn.style.marginLeft = '10px';
            debugBtn.onclick = function() {
                if (confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
                    resetConfig();
                }
            };
            document.querySelector('.control-buttons').appendChild(debugBtn);
        }

        async function initializeApp() {
            try {
                loadConfig();
                applyConfigToUI();

                document.getElementById('loadingIndicator').style.display = 'block';
                document.getElementById('weatherDashboard').style.display = 'none';

                await fetchWeatherData();
                lastUpdateTime = getYakutskTime();

                updateApiStatus();
                updateLastUpdateTime();
                updateNextUpdateInfo();

                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('weatherDashboard').style.display = 'grid';
                document.getElementById('chartsSection').style.display = 'block';
                document.getElementById('advancedSection').style.display = 'block';

                renderWeatherCards();
                createTemperatureChart();
                createRadarChart();

                addDebugButton();

            } catch (error) {
                console.error('Error initializing app:', error);
                document.getElementById('loadingIndicator').innerHTML =
                    '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.';

                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('weatherDashboard').style.display = 'grid';
                document.getElementById('chartsSection').style.display = 'block';
                document.getElementById('advancedSection').style.display = 'block';

                updateApiStatus();
                renderWeatherCards();
                createTemperatureChart();
                createRadarChart();
            }
        }

        document.getElementById('refreshBtn').addEventListener('click', refreshData);
        document.getElementById('settingsBtn').addEventListener('click', openSettingsModal);
        document.getElementById('mapBtn').addEventListener('click', openMapModal);
        document.getElementById('closeSettingsModal').addEventListener('click', closeSettingsModal);
        document.getElementById('closeMapModal').addEventListener('click', closeMapModal);
        document.getElementById('cancelSettings').addEventListener('click', closeSettingsModal);
        document.getElementById('cancelMap').addEventListener('click', closeMapModal);
        document.getElementById('saveSettings').addEventListener('click', saveSettings);
        document.getElementById('saveLocation').addEventListener('click', addCustomLocation);

        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) closeSettingsModal();
        });

        document.getElementById('mapModal').addEventListener('click', function(e) {
            if (e.target === this) closeMapModal();
        });

        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();

            setInterval(updateHeaderTime, 1000);

            setInterval(() => {
                const timeElements = document.querySelectorAll('.weather-card .time');
                timeElements.forEach(element => {
                    element.textContent = formatTime(getYakutskTime());
                });
            }, 1000);

            setInterval(updateNextUpdateInfo, 1000);
        });

        window.deleteCustomLocation = deleteCustomLocation;
    </script>
</body>
</html>